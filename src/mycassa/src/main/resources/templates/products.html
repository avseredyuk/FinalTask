<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" th:href="@{/css/main.css}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
		integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

	<title th:text="#{products}">Products</title>
</head>

<body>
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
		integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
		crossorigin="anonymous"></script>

	<header>
		<div th:insert="~{fragments/header :: copy}"></div>
	</header>
	<div class="bodyContainer">

		<!-- <a th:href="@{/sessions}" class="btn btn-outline-danger bi bi-arrow-left-square ml-3 mt-3" role="button" aria-pressed="true"></a>-->

		<div class="sectionMainContent text-center">



			<form th:action="@{/products}">
				<div class="d-flex shadow p-3 mb-5 mt-5 bg-light rounded">
					<div th:if="${products.products.hasContent()}">

						<select class="custom-select" th:name="filterField">
							<option value="ean"
								th:selected="${#strings.equals(products.filterField, 'ean')}  ? 'selected'"
								th:text="#{product.ean}">ean</option>
							<option th:value="title"
								th:selected="${#strings.equals(products.filterField, 'title')}  ? 'selected'"
								th:text="#{product.title}">product title</option>
							<option th:value="price"
								th:selected="${#strings.equals(products.filterField, 'price')}  ? 'selected'"
								th:text="#{product.price}">cost</option>
							<option th:value="quantityInStore"
								th:selected="${#strings.equals(products.filterField, 'quantityInStore')}  ? 'selected'"
								th:text="#{product.quantityInStore}">quantity</option>
							<option th:value="measure"
								th:selected="${#strings.equals(products.filterField, 'measure')}  ? 'selected'"
								th:text="#{product.measure}">measure</option>
						</select>
					</div>
					<div th:if="${products.products.hasContent()}" class=" mr-5">
						<select class="ml-1  custom-select" th:name="direction">
							<option value="desc"
								th:selected="${#strings.equals(products.direction, 'desc')}  ? 'selected'"
								th:text="#{descending}">descending</option>
							<option value="asc"
								th:selected="${#strings.equals(products.direction, 'asc')}  ? 'selected'"
								th:text="#{ascending}">ascending</option>
						</select>
					</div>
					<div class="flex-grow-1">
						<div class=" input-group">
							<input type="text" class="form-control" th:placeholder="#{input.partof.ean.or.title}"
								aria-describedby="basic-addon1" name='searchQuery'
								th:value="*{products.searchQuery}">
							<div class="input-group-append">
								<button class="btn btn-primary" type="submit" th:text="#{find}">Find </button>
							</div>
						</div>
					</div>

					<div class="ml-2" sec:authorize="hasAnyAuthority('COMMODITY_EXPERT')">

						<a th:href="@{/products/new}">
							<div class="bi bi-plus-square btn btn-primary" th:title="#{product.add}"></div>
						</a>

					</div>
				</div>



			</form>

			<div th:if="${products.products.hasContent()}"
				class="d-flex justify-content-center shadow p-3 bg-light rounded">

				<div class="">
					<table class="table table-hover">
						<thead class="thead-light">
							<tr>

								<th th:text="#{product.ean}">Ean</th>
								<th class="titleColumn" th:text="#{product.title}">Title</th>
								<th th:text="#{product.cost}">Price</th>
								<th th:text="#{product.quantityInStore}">Quantity</th>
								<th th:text="#{product.measure}">Measure</th>
								<th sec:authorize="hasAnyAuthority('COMMODITY_EXPERT')" th:text="#{edit}">Edit</th>
								<th sec:authorize="hasAnyAuthority('CASHIER')"></th>
							</tr>
						</thead>
						<tbody>
							<tr scope="row" th:each="product: ${products.products}"
								sec:authorize="hasAnyAuthority('CASHIER')">
								<td th:text="${product.ean}" />
								<td class="titleColumn" th:text="${product.title}" />
								<td th:text="${product.price}" />
								<td th:text="${product.quantityInStore}" />
								<td th:text="${product.measure}" />
								<!--	<td>
									<a th:href="@{/products/sale/{ean}(ean=${productData.ean})}"
									 class="btn btn-info bi bi-plus-square "
									  role="button" aria-pressed="true"></a>
								</td>-->

								<td>
									<span>
										<a th:href="@{/sales/{ean}/new(ean=${product.ean})}"
											class="bi bi-plus-square"></a>
									</span>

								</td>


							</tr>


							<tr scope="row" th:each="product: ${products.products}"
								sec:authorize="hasAnyAuthority('COMMODITY_EXPERT')">
								<td th:text="${product.ean}" />
								<td class="titleColumn" th:text="${product.title}" />
								<td th:text="${product.price}" />
								<td th:text="${product.quantityInStore}" />
								<td th:text="${product.measure}" />
								<td>
									<a th:href="@{/products/{ean}/edit(ean=${product.ean})}"
										class="btn bi bi-pencil-square"></a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

			</div>

			<div th:if="${products.products.hasContent()}" class="m-xl-5 d-flex justify-content-center">
				<div th:if="${products.products.hasContent()}">

					<nav>
						<ul class="pagination flex-wrap" th:with="pageUrlPrefix = '/products?filterField=' + 
					${products.filterField} + '&amp;direction=' 
					+ ${products.direction} + '&amp;searchQuery=' 
					+ ${products.searchQuery}">
							<li th:class="${!products.products.isFirst() ? 'page-item' : 'page-item disabled'}">
								<a th:href="@{${pageUrlPrefix}(page='1')}" class="page-link"><b>&laquo;</b></a>
							</li>

							<li th:class="${!products.products.isFirst() ? 'page-item' : 'page-item disabled'}">
								<a th:href="@{${pageUrlPrefix}(page=${products.products.getNumber()})}"
									class="page-link"><b>‹</b></a>
							</li>


							<li th:each="i: ${#numbers.sequence(1, products.products.getTotalPages())}"
								th:class="${products.products.getNumber()+1 != i ? 'page-item' : 'page-item active'}">
								<a th:href="@{${pageUrlPrefix}(page=${i})}" class="page-link">[[${i}]]</a>
							</li>


							<li th:class="${!products.products.isLast() ? 'page-item' : 'page-item disabled'}">
								<a th:href="@{${pageUrlPrefix}(page=${products.products.getNumber()+2})}"
									class="page-link"><b>›</b></a>
							</li>

							<li th:class="${!products.products.isLast() ? 'page-item' : 'page-item disabled'}">
								<a th:href="@{${pageUrlPrefix}(page=${products.products.getTotalPages()})}"
									class="page-link"><b>&raquo;</b></a>
							</li>
						</ul>

					</nav>
				</div>

			</div>





			<div class="m-xl-5 d-flex justify-content-center" th:if="${!products.products.hasContent()}">
				No products
			</div>

			<div class="m-xl-5 d-flex justify-content-center" sec:authorize="hasAnyAuthority('CASHIER')">
				<a th:href="@{/session/check}">
					<div class="btn btn-primary my-2 my-sm-0" th:text="#{make.check}"></div>
				</a>
			</div>






		</div>









		<footer>
			<div th:insert="~{fragments/footer :: copy}"></div>
		</footer>

	</div>


</body>


</html>